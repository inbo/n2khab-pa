# Resultaten

## Verkenning van de scores per milieudruk

```{r message=FALSE, eval=FALSE}
actie26_sheet <- gs_key("1iaHBHlVNh9Cw35_9DYb0WDxmVJgpOEck_wBcFWVvsfk")
tab_colnames <- 
    actie26_sheet %>% 
        gs_read(ws = "EvaluatieMilieudrukkenScores",
                range = "A1:Y1",
                col_names = FALSE) %>% 
        t %>% 
        as.vector
actie26_sheet %>% 
    gs_read(ws = "EvaluatieMilieudrukkenScores",
            range = cell_cols(1:25),
            skip = 2,
            col_names = tab_colnames,
            col_types = str_c("c", str_c(rep("cii", 8), collapse = ""))
            ) %>% 
    gather(key = "Onderwerp", value = "Waarde", 2:25) %>% 
    mutate(Milieudruk = factor(Milieudruk),
           Vraag = str_extract(Onderwerp, "\\w+") %>% as.factor,
           Antwoordtype = ifelse(
               str_detect(Onderwerp, ":S"),
               "Score",
               ifelse(str_detect(Onderwerp, ":B"), 
                      "Betrouwbaarheid",
                      "Uitleg")
               ) %>% 
               factor(levels = c("Score", "Betrouwbaarheid", "Uitleg"))
           ) %>%
    select(Milieudruk, Vraag, Antwoordtype, Waarde) %>% 
    write_vc("actie26", 
             sorting = c("Milieudruk", "Vraag", "Antwoordtype"))
```

```{r}
actie26 <- read_vc("actie26")
levels(actie26$Vraag) <- 
    c("A1_problematiek",
      "A2a_actieradius",
      "A2b_geogr_spreiding",
      "A4_complexiteit",
      "B2b_tekort_beleidsinstrum",
      "M1_bronger_maatreg",
      "T1_informatie",
      "T4_grenswaarden")
```



```{r eval=FALSE}
actie26 %>% 
    str(give.attr = FALSE)
```

```{r eval=FALSE}
actie26 %>% 
    spread(key = Antwoordtype, value = Waarde) %>% 
    summarise(
        Score_NA = sum(is.na(Score)),
        Betrouwbaarheid_NA = sum(is.na(Betrouwbaarheid)),
        Uitleg_NA = sum(is.na(Uitleg)),
    )
```



```{r warning=FALSE}
actie26 %>% 
    filter(Antwoordtype == "Score") %>% 
    mutate(Waarde = factor(Waarde)) %>% 
    ggplot(aes(x = Waarde)) +
    geom_histogram(stat = "count", 
                   fill = "springgreen4") +
    facet_wrap(~Vraag)
```

Verdeling van de betrouwbaarheid van de antwoorden:

```{r warning=FALSE}
actie26 %>% 
    filter(Antwoordtype == "Betrouwbaarheid") %>% 
    mutate(Waarde = factor(Waarde)) %>% 
    ggplot(aes(x = Vraag, fill = Waarde)) +
    geom_bar(stat = "count") +
    scale_fill_manual(values = c("tomato", "orange", "springgreen4")) +
    coord_flip()
```


## Correlatie tussen scores

```{r}
actie26_scores <- 
    actie26 %>% 
    filter(Antwoordtype == "Score") %>% 
    select(-Antwoordtype) %>% 
    mutate(Waarde = as.integer(Waarde)) %>% 
    spread(key = Vraag, value = Waarde)
```

```{r warning=FALSE, fig.width=10, fig.height=10}
actie26_scores %>% 
    select(-Milieudruk) %>% 
    ggpairs(upper = list(continuous = GGally::wrap("cor", method = "kendall")),
            lower = list(continuous = GGally::wrap("points", size = 0.5, alpha = 0.25))
            ) %>% 
        print(progress = FALSE)
```

## Gewichten toekennen aan criteria

XXXX Als we dit gaan gebruiken, wordt de onderstaande tabel best verhuisd naar een hoofdstuk 'methoden'.

```{r}
gewichten <- 
    tribble(
      ~Vraag,           ~Gewicht,
      "A1_problematiek", 10,
      "A2a_actieradius", 2,
      "A2b_geogr_spreiding", 5,
      "A4_complexiteit", 4,
      "B2b_tekort_beleidsinstrum", 7,
      "M1_bronger_maatreg", 5,
      "T1_informatie", 5,
      "T4_grenswaarden", 2
) %>% 
    mutate(Vraag = factor(Vraag))
gewichten %>% 
    kable
```


## Rangschikking van milieudrukken

```{r message=FALSE}
actie26_rang <- 
    actie26 %>% 
    filter(Antwoordtype == "Score") %>% 
    inner_join(gewichten) %>% 
    mutate(Waarde = as.integer(Waarde),
           Gewogen = Waarde * Gewicht) %>%  
    group_by(Milieudruk) %>% 
    summarise(Eindscore_gewogen = sum(Gewogen) / sum(Gewicht),
              Eindscore_ongewogen = mean(Waarde)
              ) %>% 
    mutate(Rang_gewogen = rank(Eindscore_gewogen * (-1), 
                                 ties.method = "min"),
           Rang_ongewogen = rank(Eindscore_ongewogen * (-1), 
                                 ties.method = "min")
           )
actie26_rang %>% 
    arrange(Rang_gewogen, 
            Rang_ongewogen) %>% 
    kable
```

```{r pca, message=FALSE}
actie26_scores_kort <- 
    actie26_scores %>% 
    inner_join(actie26_rang) %>% 
    tidyr::extract(Milieudruk,
                    c("Nummer", "String"),
               "([\\w\\.]+)\\s.+ (stikstof|fosfor|)"
            ) %>% 
    mutate(String = ifelse(String == "stikstof", "N",
                           ifelse(String == "fosfor", "P", String))) %>% 
    tidyr::unite("Milieudruk_kort", c("Nummer", "String"), sep = "")
actie26_pca <- 
    actie26_scores_kort %>% 
    column_to_rownames(var = "Milieudruk_kort") %>% 
    select(2:9) %>% 
    rda() # dit doet een PCA, maar levert een vegan-compatibel object op (prcomp-functie niet)
```

```{r eval=FALSE}
actie26_pca %>% 
    ggscreeplot("both")
```

Of numeriek:

```{r pca_stats}
actie26_pca %>% 
    summary %>% 
    .$cont %>% 
    .$importance
```



```{r scores_groter, message=FALSE, include=FALSE}
actie26_scores_rang_pca <- 
    actie26_pca %>% 
    scores(choices = 1:3) %>% 
    .$sites %>% 
    as.data.frame %>% 
    rownames_to_column(var = "Milieudruk_kort") %>% 
    mutate_at(.vars = 2:4, .funs = function(x) x*2) %>% 
    inner_join(actie26_scores_kort, .)
actie26_scores_rang_pca %>% str
```


```{r biplots, message = FALSE, warning=FALSE, include=FALSE}
basisbiplot1 <- 
    actie26_pca %>% 
    ggbiplot_vegan(choices = c(1,2),
                   # base_sizes = c(1,2,2),
                   # site_data = df,
                   site_geom = "blank"
                   # site_mapping = aes(colour = Hoofdtype, label = Vegcode)
) 
    # xlim(-3,3) +
    # ylim(-3,3) +
    # theme(legend.position = "none")

basisbiplot2 <- 
    actie26_pca %>% 
    ggbiplot_vegan(choices = c(1,3),
                   site_geom = "blank"
    )
```




De ordinatiediagrammen (biplots) zijn louter een verder visueel hulpmiddel om de types te spreiden in een ruimte op basis van de geselecteerde kenmerken. Onderstaand zijn 2 biplots weergegeven (PC1+2 resp. PC1+3) waar de pijlen de relatie van de 4 indices met de PC's en hun onderlinge relatie vertegenwoordigen. De types zijn gekleurd volgens `Totaalindex`:

```{r message = FALSE, warning=FALSE}
biplotopmaak <- list(
    scale_x_continuous(),
    scale_y_continuous(), 
    theme_bw())

bp12 <- 
    basisbiplot1 +
    list(actie26_scores_rang_pca,
         aes(x = PC1, y = PC2),
         geom_point(aes(fill = Eindscore_gewogen), size = 3, shape = 21),
         scale_fill_gradientn(colours = rev(topo.colors(25)))
        ) +
    biplotopmaak

bp13 <- 
    basisbiplot2 +
    list(actie26_scores_rang_pca,
         aes(x = PC1, y = PC3),
         geom_point(aes(fill = Eindscore_gewogen), size = 3, shape = 21),
         scale_fill_gradientn(colours = rev(topo.colors(25)))
        ) +
    biplotopmaak
```



```{r biplot_met_punten12, fig.width=10, fig.height=10}
bp12 +
    list(geom_text(aes(label = Milieudruk_kort), size = 3, vjust = 2)
        )
```


```{r biplot_met_punten13, fig.width=10, fig.height=10}
bp12 +
    list(geom_text(aes(label = Milieudruk_kort), size = 3, vjust = 2)
        )
```





